<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>月度账单</title>
    <!-- 添加Element Plus的样式和脚本 -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/ai-assistant.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style>
        /* 添加内联样式处理图标 */
        .placeholder-icon {
            width: 24px;
            height: 24px;
            background-color: #e0e0e0;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #666;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        /* Element Plus 组件样式覆盖 */
        :root {
            --el-color-primary: #00B45E !important;
            --el-color-primary-light-3: #4DC88E !important;
            --el-color-primary-light-5: #88DCB3 !important;
            --el-color-primary-light-7: #BDF0D5 !important;
            --el-color-primary-light-9: #EDFAF5 !important;
            --el-color-primary-dark-2: #00914B !important;
        }
        
        /* Element Plus 按钮样式覆盖 */
        .el-button--primary {
            --el-button-bg-color: #00B45E !important;
            --el-button-border-color: #00B45E !important;
            --el-button-hover-bg-color: #00914B !important;
            --el-button-hover-border-color: #00914B !important;
        }
        
        /* Element Plus Radio按钮样式覆盖 */
        .el-radio-button__orig-radio:checked + .el-radio-button__inner {
            background-color: #00B45E !important;
            border-color: #00B45E !important;
            box-shadow: -1px 0 0 0 #00B45E !important;
        }
        
        /* Element Plus Checkbox样式覆盖 */
        .el-checkbox__input.is-checked .el-checkbox__inner {
            background-color: #00B45E !important;
            border-color: #00B45E !important;
        }
        
        .el-checkbox__input.is-checked + .el-checkbox__label {
            color: #00B45E !important;
        }
        
        .el-checkbox.is-bordered.is-checked {
            border-color: #00B45E !important;
        }
        
                 /* 图表样式 */
        
        /* 原有样式保留 */
        .nav-item.active .placeholder-icon,
        .subnav-item.active .placeholder-icon {
            background-color: #00B45E;
            color: white;
        }
        
        /* 首页内容区域样式调整，与工作台页面保持一致 */
        .main-content {
            padding-top: 0 !important;
        }
        
        /* 设置内容区域与头部连接 */
        .content-wrapper {
            padding: 0 !important;
            margin-top: 64px !important; /* 头部高度为64px */
        }
        
        /* dashboard与头部间距 */
        .dashboard.energy-trend-content {
            margin-top: 20px;
        }
        
        /* 右侧内容自适应样式 */
        .right-side .filter-controls,
        .right-side .energy-stats-overview,
        .right-side .chart-container {
            width: 98%;
            box-sizing: border-box;
        }
        
        /* 确保统计卡片在窄屏幕上自适应 */
        @media (max-width: 1366px) {
            .energy-stats-overview-wrapper {
                padding: 0 10px !important;
            }
            
            .energy-stats-overview {
                flex-wrap: wrap;
                justify-content: center;
                max-width: 98% !important;
            }
            
            .energy-stats-overview .stat-card {
                min-width: calc(33.33% - 2px);
                flex: 1 1 calc(33.33% - 2px);
                border-bottom: 1px solid #EAEAEA;
            }
            
            .energy-stats-overview .stat-card:last-child {
                border-right: 1px solid #EAEAEA;
            }
            
            /* 日期控制和过滤控制在窄屏上自适应 */
            .filter-controls {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
                padding: 16px 10px !important;
                width: 100%;
                max-width: 100% !important;
                box-sizing: border-box;
            }
            
            .filter-controls .control-group {
                width: 100%;
                justify-content: space-between;
            }
            
            /* 调整日期控制的布局 */
            .date-control {
                flex-wrap: wrap;
                row-gap: 10px;
            }
            
            /* 确保图表容器在窄屏上自适应 */
            #usage-query-content {
                padding: 0 10px !important;
            }
            
            #usage-query-content,
            #account-usage-content {
                width: 100% !important;
                max-width: 100% !important;
                overflow-x: hidden;
            }
        }
        
        /* 需要删除之前设置的内部容器max-width */
        .energy-trend-content {
            width: 100%;
            padding: 0 !important;
        }
        
        /* 头部样式调整 */
        .header {
            z-index: 100;
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }
        
        .header-bottom {
            height: 24px;
            display: flex;
            align-items: center;
        }
        
        /* 确保AI助手不被其他元素遮挡 */
        .ai-assistant-container {
            z-index: 10000 !important;
        }
        
        /* 左侧导航样式修改 */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 200;
            width: 80px;
        }
        
        /* 抽屉式二级菜单样式 */
        .subnav-container {
            display: none;
            background-color: white;
            position: fixed;
            left: 80px;
            width: 160px;
            border-right: 1px solid #EAEAEA;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            height: calc(100vh - 64px);
            top: 64px;
            z-index: 99;
        }
        
        /* 主内容区域调整，为左侧导航腾出空间 */
        .main-content {
            margin-left: 80px;
            padding-top: 0 !important;
            width: calc(100% - 80px);
        }
        
        /* 当二级导航显示时，主内容区域宽度调整 */
        .main-content.with-subnav {
            margin-left: 240px;
            width: calc(100% - 240px);
        }
        
        /* 租户层级与二级导航间距 */
        .main-content.with-subnav .left-side {
            margin-left: 20px;
        }
        
        .subnav-header {
            padding: 16px;
            font-weight: 500;
            color: #333;
            border-bottom: 1px solid #EAEAEA;
        }
        
        .subnav-list {
            padding: 8px 0;
        }
        
        .subnav-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .subnav-link {
            text-decoration: none;
            color: inherit;
            display: flex;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        
        .subnav-item:hover {
            background-color: rgba(0,180,94,0.05);
        }
        
        .subnav-item.active {
            background-color: rgba(0,180,94,0.1);
            position: relative;
        }
        
        .subnav-item span {
            color: #666;
            font-size: 14px;
        }
        
        .subnav-item.active span {
            color: #00B45E;
            font-weight: 500;
        }

        /* 媒体查询保持与其他页面一致 */
        @media (max-width: 1600px), (max-width: 1200px) {
            .content-wrapper {
                padding: 0 !important;
            }
        }
        
        .subnav-container.visible {
            display: block;
        }

        /* 节点树样式 */
        .node-tree {
            margin: 0; /* 确保上下间距贴合边框 */
            padding: 0; /* 内边距 */
            background-color: white;
        }
        
        /* Element UI Tree组件样式 */
        .el-card__body {
            background-color: white;
        }

        .node-item {
            padding: 4px 0; /* 节点项的上下间距 */
            border-bottom: 1px solid #EAEAEA; /* 节点项之间的分隔线 */
            cursor: pointer;
        }

        .node-item:last-child {
            border-bottom: none; /* 最后一个节点项不显示分隔线 */
        }
        
        .node-content {
            padding: 8px 10px;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .node-content:hover {
            background-color: rgba(0,180,94,0.05);
        }
        
        .node-item.selected > .node-content {
            background-color: rgba(0,180,94,0.1);
        }
        
        .node-item.selected > .node-content span {
            color: #00B45E;
            font-weight: 500;
        }
        
        .node-content span {
            color: #333;
            font-size: 14px;
        }
        
        .node-children {
            margin-left: 0;
        }
        
        /* 多任务标签样式 */
        .tab.multitask {
            display: flex;
            align-items: center;
            color: #666;
            font-size: 14px;
            position: relative;
            height: 100%;
            padding-top: 0;
            padding-bottom: 0;
        }
        
        .header-bottom .tabs .tab.multitask {
            opacity: 1;
            visibility: visible;
            white-space: nowrap;
            line-height: 24px; /* 与header-bottom高度保持一致 */
        }

        /* 修改内容区域padding和间距 */
        .energy-query-section {
            background: #fff;
            padding: 0;
            margin-bottom: 16px;
            border-radius: 4px;
            position: relative;
            top: 0;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.05);
        }

        .tabs-container {
            display: flex;
            border-bottom: 1px solid #E0E4E8;
            padding: 0 24px;
            margin-top: 0;
        }

        .tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0px 16px;
            margin-right: 32px;
            cursor: pointer;
            position: relative;
        }

        /* 防止横向滚动条出现 */
        body, html {
            overflow-x: hidden;
            max-width: 100%;
        }

        /* 修改能耗数据概览样式 */
        .energy-stats-overview-wrapper {
            display: flex;
            justify-content: center;
            padding: 0 20px;
        }

        .energy-stats-overview {
            max-width: 1200px;
            width: 100%;
            display: flex;
            margin-bottom: 16px;
            margin-top: 0;
            gap: 0;
            justify-content: center;
        }

        .stat-card {
            background-color: #F8FAFB;
            padding: 16px 24px;
            border-radius: 0;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 120px;
            box-sizing: border-box;
            border-right: 1px solid #EAEAEA;
            text-align: center;
        }

        /* 复选框控制样式 */
        .checkbox-control {
            display: flex;
            align-items: center;
            gap: 16px; /* 调整间距 */
        }

        /* 复选框样式 */
        .checkbox-control input[type="checkbox"] {
            position: relative;
            width: 16px;
            height: 16px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            outline: none;
            border: 1px solid #CBCFD4;
            border-radius: 2px;
            cursor: pointer;
        }

        .checkbox-control input[type="checkbox"]:checked {
            border-color: #29B061;
            background-color: #29B061;
        }

        .checkbox-control input[type="checkbox"]:checked::before {
            content: '✓';
            color: white;
            position: absolute;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-control label {
            font-size: 14px;
            color: #29B061;
        }

        /* 确保电能筛选框的样式一致 */
        .control-group {
            display: flex;
            gap: 16px; /* 与复选框间距一致 */
            align-items: center;
        }

        /* 修改 el-checkbox 的样式 */
        .el-checkbox {
            width: 50px; /* 设置宽度为 50px */
            border: none; /* 去掉边框效果 */
        }

        .el-checkbox.is-bordered {
            border: none; /* 确保边框样式为 none */
        }

        .el-checkbox__input {
            border: none; /* 去掉复选框的边框 */
        }

        .el-checkbox__label {
            margin-left: 0; /* 调整标签的左边距 */
        }

        /* 添加搜索高亮样式 */
        .highlight {
            background-color: #FFFAA8;
            color: #333;
            padding: 0 2px;
            border-radius: 2px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- 左侧导航 -->
        <div class="sidebar">
            <div class="logo-container">
                <div class="logo">
                    <div class="placeholder-icon" style="background-color: #00B45E; color: white;">CE</div>
                </div>
            </div>
            <div class="nav-container">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="home.html" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">首</div>
                            </div>
                            <span>首页</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">工</div>
                            </div>
                            <span>工作台</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="power-monitoring.html" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">电</div>
                            </div>
                            <span>电力监控</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="power-analysis.html" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">分</div>
                            </div>
                            <span>电能分析</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">成</div>
                            </div>
                            <span>成本分析</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">新</div>
                            </div>
                            <span>新能源</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <div class="nav-icon">
                                <div class="placeholder-icon">碳</div>
                            </div>
                            <span>碳资产</span>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a href="energy-trend.html" class="nav-link" id="safetyMenuItem">
                            <div class="nav-icon">
                                <div class="placeholder-icon">安</div>
                            </div>
                            <span>安全用电</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- 二级抽屉式导航 -->
        <div class="subnav-container visible">
            <div class="subnav-header">安全用电</div>
            <ul class="subnav-list">
                <li class="subnav-item">
                    <a href="energy-trend.html" class="subnav-link">
                        <span>能耗趋势分析</span>
                    </a>
                </li>
                <li class="subnav-item active">
                    <a href="monthly-bill.html" class="subnav-link" data-page="monthly-bill">
                        <span>月度账单</span>
                    </a>
                </li>
                <li class="subnav-item">
                    <a href="chaobiaojifei.html" class="subnav-link" data-page="chaobiaojifei">
                        <span>抄表计费</span>
                    </a>
                </li>
                <li class="subnav-item">
                    <a href="#" class="subnav-link" data-page="archive-management">
                        <span>档案管理</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- 主内容区 -->
        <div class="main-content with-subnav">
            <!-- 头部导航区 -->
            <header class="header">
                <div class="header-top">
                    <div class="nav-toggle" id="navToggle">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 12H21" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3 6H21" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3 18H21" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="breadcrumb active">
                        <span>安全用电 / 月度账单</span>
                    </div>
                    <div class="user-area">
                        <div class="icon-group">
                            <div class="icon-circle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 21L16.65 16.65" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="icon-circle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 14C19 11.7909 16.7614 10 14 10H12.8184C10.6702 10 8.71062 9.00736 7.55375 7.31655C7.30044 6.9535 7 5.93336 7 5.93335C7 5.31352 7.62791 4.78719 8.25574 4.8643C11.303 5.16203 13.0274 5.88513 15.0858 7.94353C16.634 9.49176 19 10.9789 19 14Z" stroke="#666" stroke-width="2"/>
                                    <path d="M19 14V18C19 19.1046 18.1046 20 17 20H7C5.89543 20 5 19.1046 5 18V6C5 4.89543 5.89543 4 7 4" stroke="#666" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="icon-circle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M13.73 21C13.5542 21.3031 13.3019 21.5547 12.9982 21.7295C12.6946 21.9044 12.3504 21.9965 12 21.9965C11.6496 21.9965 11.3054 21.9044 11.0018 21.7295C10.6982 21.5547 10.4458 21.3031 10.27 21" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="icon-circle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.4 15C19.2669 15.3016 19.2272 15.6362 19.286 15.9606C19.3448 16.285 19.4995 16.5843 19.73 16.82L19.79 16.88C19.976 17.0657 20.1235 17.2863 20.2241 17.5291C20.3248 17.7719 20.3766 18.0322 20.3766 18.295C20.3766 18.5578 20.3248 18.8181 20.2241 19.0609C20.1235 19.3037 19.976 19.5243 19.79 19.71C19.6043 19.896 19.3837 20.0435 19.1409 20.1441C18.8981 20.2448 18.6378 20.2966 18.375 20.2966C18.1122 20.2966 17.8519 20.2448 17.6091 20.1441C17.3663 20.0435 17.1457 19.896 16.96 19.71L16.9 19.65C16.6643 19.4195 16.365 19.2648 16.0406 19.206C15.7162 19.1472 15.3816 19.1869 15.08 19.32C14.7842 19.4468 14.532 19.6572 14.3543 19.9255C14.1766 20.1938 14.0813 20.5082 14.08 20.83V21C14.08 21.5304 13.8693 22.0391 13.4942 22.4142C13.1191 22.7893 12.6104 23 12.08 23C11.5496 23 11.0409 22.7893 10.6658 22.4142C10.2907 22.0391 10.08 21.5304 10.08 21V20.91C10.0723 20.579 9.96512 20.258 9.77251 19.9887C9.5799 19.7194 9.31074 19.5143 9 19.4C8.69838 19.2669 8.36381 19.2272 8.03941 19.286C7.71502 19.3448 7.41568 19.4995 7.18 19.73L7.12 19.79C6.93425 19.976 6.71368 20.1235 6.47088 20.2241C6.22808 20.3248 5.96783 20.3766 5.705 20.3766C5.44217 20.3766 5.18192 20.3248 4.93912 20.2241C4.69632 20.1235 4.47575 19.976 4.29 19.79C4.10405 19.6043 3.95653 19.3837 3.85588 19.1409C3.75523 18.8981 3.70343 18.6378 3.70343 18.375C3.70343 18.1122 3.75523 17.8519 3.85588 17.6091C3.95653 17.3663 4.10405 17.1457 4.29 16.96L4.35 16.9C4.58054 16.6643 4.73519 16.365 4.794 16.0406C4.85282 15.7162 4.81312 15.3816 4.68 15.08C4.55324 14.7842 4.34276 14.532 4.07447 14.3543C3.80618 14.1766 3.49179 14.0813 3.17 14.08H3C2.46957 14.08 1.96086 13.8693 1.58579 13.4942C1.21071 13.1191 1 12.6104 1 12.08C1 11.5496 1.21071 11.0409 1.58579 10.6658C1.96086 10.2907 2.46957 10.08 3 10.08H3.09C3.42099 10.0723 3.742 9.96512 4.0113 9.77251C4.28059 9.5799 4.48572 9.31074 4.6 9C4.73312 8.69838 4.77282 8.36381 4.714 8.03941C4.65519 7.71502 4.50054 7.41568 4.27 7.18L4.21 7.12C4.02405 6.93425 3.87653 6.71368 3.77588 6.47088C3.67523 6.22808 3.62343 5.96783 3.62343 5.705C3.62343 5.44217 3.67523 5.18192 3.77588 4.93912C3.87653 4.69632 4.02405 4.47575 4.21 4.29C4.39575 4.10405 4.61632 3.95653 4.85912 3.85588C5.10192 3.75523 5.36217 3.70343 5.625 3.70343C5.88783 3.70343 6.14808 3.75523 6.39088 3.85588C6.63368 3.95653 6.85425 4.10405 7.04 4.29L7.1 4.35C7.33568 4.58054 7.63502 4.73519 7.95941 4.794C8.28381 4.85282 8.61838 4.81312 8.92 4.68H9C9.29577 4.55324 9.54802 4.34276 9.72569 4.07447C9.90337 3.80618 9.99872 3.49179 10 3.17V3C10 2.46957 10.2107 1.96086 10.5858 1.58579C10.9609 1.21071 11.4696 1 12 1C12.5304 1 13.0391 1.21071 13.4142 1.58579C13.7893 1.96086 14 2.46957 14 3V3.09C14.0013 3.41179 14.0966 3.72618 14.2743 3.99447C14.452 4.26276 14.7042 4.47324 15 4.6C15.3016 4.73312 15.6362 4.77282 15.9606 4.714C16.285 4.65519 16.5843 4.50054 16.82 4.27L16.88 4.21C17.0657 4.02405 17.2863 3.87653 17.5291 3.77588C17.7719 3.67523 18.0322 3.62343 18.295 3.62343C18.5578 3.62343 18.8181 3.67523 19.0609 3.77588C19.3037 3.87653 19.5243 4.02405 19.71 4.21C19.896 4.39575 20.0435 4.61632 20.1441 4.85912C20.2448 5.10192 20.2966 5.36217 20.2966 5.625C20.2966 5.88783 20.2448 6.14808 20.1441 6.39088C20.0435 6.63368 19.896 6.85425 19.71 7.04L19.65 7.1C19.4195 7.33568 19.2648 7.63502 19.206 7.95941C19.1472 8.28381 19.1869 8.61838 19.32 8.92V9C19.4468 9.29577 19.6572 9.54802 19.9255 9.72569C20.1938 9.90337 20.5082 9.99872 20.83 10H21C21.5304 10 22.0391 10.2107 22.4142 10.5858C22.7893 10.9609 23 11.4696 23 12C23 12.5304 22.7893 13.0391 22.4142 13.4142C22.0391 13.7893 21.5304 14 21 14H20.91C20.5882 14.0013 20.2738 14.0966 20.0055 14.2743C19.7372 14.452 19.5268 14.7042 19.4 15Z" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                        </div>
                        <div class="user-info">
                            <div class="avatar">ZM</div>
                            <p class="user-name">张淼妙</p>
                        </div>
                    </div>
                </div>
                <div class="header-bottom">
                    <div class="tabs">
                        <div class="tab active">月度账单</div>
                        <div class="tab multitask">多任务菜单</div>
                    </div>
                </div>
            </header>

            <!-- 月度账单内容区域 -->
            <div class="content-wrapper">
                <div class="dashboard energy-trend-content" style="display: flex; flex-direction: row; gap: 20px; height: 860px;">
                    <!-- 左侧搜索和节点树 -->
                    <div class="left-side" style="width: 240px; flex-shrink: 0; margin-top: 0;">
                        <!-- 搜索框和节点树卡片 -->
                        <div class="el-card" style="box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1); border-radius: 4px; border: 1px solid #EBEEF5; background-color: white; height: 860px;">
                            <div class="el-card__header" style="padding: 12px 16px; border-bottom: 1px solid #EBEEF5;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px; color: #303133; font-weight: 500;">租户列表</span>
                                </div>
                            </div>
                            <div class="el-card__body" style="padding: 16px 16px 0;">
                                <div class="el-input" style="position: relative; width: 100%; margin-bottom: 16px;">
                                    <input type="text" placeholder="请输入关键字" class="el-input__inner" style="width: 100%; height: 32px; line-height: 32px; padding: 0 30px 0 15px; background-color: #FFFFFF; background-image: none; border-radius: 4px; border: 1px solid #DCDFE6; box-sizing: border-box; color: #606266; font-size: 14px;">
                                    <span class="el-input__suffix" style="position: absolute; height: 100%; right: 5px; top: 0; text-align: center; color: #C0C4CC; font-size: 14px; line-height: 32px;">
                                        <i class="el-icon-search" style="color: #909399;">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#909399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M21 21L16.65 16.65" stroke="#909399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </i>
                                    </span>
                                </div>
                                <div style="border-top: 1px solid #EBEEF5; margin: 0 -16px;"></div>
                            </div>
                            <div class="el-card__body" style="padding: 0;">
                                <div class="el-tree" style="width: 100%; height: calc(100% - 130px); overflow-y: auto; margin-top: 0; background-color: white;">
                                    <!-- 树形控件层级结构 -->
                                    <div class="el-tree-node is-expanded" style="padding: 0;">
                                        <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: white;">
                                            <span class="el-tree-node__expand-icon expanded" style="transform: rotate(90deg); margin-right: 8px; font-size: 12px; color: #909399;">
                                                <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                    <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#C0C4CC"></path>
                                                </svg>
                                            </span>
                                            <span class="el-tree-node__label" style="font-size: 14px; color: #606266;">所有租户</span>
                                        </div>
                                        <div class="el-tree-node__children" style="padding-left: 18px;">
                                            <!-- 恒和园节点及子节点 -->
                                            <div class="el-tree-node is-expanded is-current" style="padding: 0;">
                                                <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: #F5F7FA;">
                                                    <span class="el-tree-node__expand-icon expanded" style="transform: rotate(90deg); margin-right: 8px; font-size: 12px; color: #909399;">
                                                        <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                            <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#409EFF"></path>
                                                        </svg>
                                                    </span>
                                                    <span class="el-tree-node__label" style="font-size: 14px; color: #409EFF; font-weight: 500;">恒和园</span>
                                                </div>
                                                <div class="el-tree-node__children" style="padding-left: 18px;">
                                                    <div class="el-tree-node" style="padding: 0;">
                                                        <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: white;">
                                                            <span class="el-tree-node__expand-icon is-leaf" style="visibility: hidden; margin-right: 8px; font-size: 12px; color: #909399;">
                                                                <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                                    <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#C0C4CC"></path>
                                                                </svg>
                                                            </span>
                                                            <span class="el-tree-node__label" style="font-size: 14px; color: #606266;">恒和园一层</span>
                                                        </div>
                                                    </div>
                                                    <div class="el-tree-node" style="padding: 0;">
                                                        <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: white;">
                                                            <span class="el-tree-node__expand-icon is-leaf" style="visibility: hidden; margin-right: 8px; font-size: 12px; color: #909399;">
                                                                <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                                    <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#C0C4CC"></path>
                                                                </svg>
                                                            </span>
                                                            <span class="el-tree-node__label" style="font-size: 14px; color: #606266;">恒和园二层</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 知春园南区节点 -->
                                            <div class="el-tree-node" style="padding: 0;">
                                                <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: white;">
                                                    <span class="el-tree-node__expand-icon" style="margin-right: 8px; font-size: 12px; color: #909399;">
                                                        <!-- <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                            <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#C0C4CC"></path>
                                                        </svg> -->
                                                    </span>
                                                    <span class="el-tree-node__label" style="font-size: 14px; color: #606266;">知春园南区</span>
                                                </div>
                                            </div>
                                            
                                            <!-- 知春园东区节点 -->
                                            <div class="el-tree-node" style="padding: 0;">
                                                <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: white;">
                                                    <span class="el-tree-node__expand-icon" style="margin-right: 8px; font-size: 12px; color: #909399;">
                                                        <!-- <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                            <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#C0C4CC"></path>
                                                        </svg> -->
                                                    </span>
                                                    <span class="el-tree-node__label" style="font-size: 14px; color: #606266;">知春园东区</span>
                                                </div>
                                            </div>
                                            
                                            <!-- 锦秋园节点 -->
                                            <div class="el-tree-node" style="padding: 0;">
                                                <div class="el-tree-node__content" style="padding: 8px 18px; height: 32px; display: flex; align-items: center; cursor: pointer; background-color: white;">
                                                    <span class="el-tree-node__expand-icon" style="margin-right: 8px; font-size: 12px; color: #909399;">
                                                        <!-- <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                            <path d="M857.70558 495.009024 397.943314 27.513634c-7.132444-7.251148-18.794042-7.350408-26.048259-0.216941-7.253194 7.132444-7.350408 18.795065-0.216941 26.048259l446.952518 454.470749L371.678114 962.287215c-7.132444 7.253194-7.036254 18.915839 0.216941 26.048259 3.605916 3.540471 8.286527 5.309695 12.915659 5.309695 4.752048 0 9.502049-1.856601 13.13260-5.5266 459.762267-467.495389 459.762267-467.495389 459.762267-492.559545L857.70558 495.009024z" fill="#C0C4CC"></path>
                                                        </svg> -->
                                                    </span>
                                                    <span class="el-tree-node__label" style="font-size: 14px; color: #606266;">锦秋园</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 右侧月度账单列表 -->
                    <div class="right-side" style="flex: 1; overflow-y: hidden; margin-top: 0;">
                        <!-- 月度账单列表 -->
                        <div class="el-card" style="box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1); border-radius: 4px; border: 1px solid #EBEEF5; background-color: white; margin-bottom: 20px; height: 860px; display: flex; flex-direction: column;">
                            <div class="el-card__header" style="padding: 12px 16px; border-bottom: 1px solid #EBEEF5; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;">
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 14px; color: #606266; font-weight: 500;" id="selectedTenantName">恒和园</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <!-- 搜索框 -->
                                    <div class="el-input" style="width: 240px; position: relative;">
                                        <input type="text" placeholder="请输入钱包名 账户名" class="el-input__inner" style="width: 100%; height: 32px; line-height: 32px; padding: 0 30px 0 15px; background-color: #FFFFFF; background-image: none; border-radius: 4px; border: 1px solid #DCDFE6; box-sizing: border-box; color: #606266; font-size: 14px;">
                                        <span class="el-input__suffix" style="position: absolute; height: 100%; right: 5px; top: 0; text-align: center; color: #C0C4CC; font-size: 14px; line-height: 32px;">
                                            <i class="el-icon-search" style="color: #909399;">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="#909399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M21 21L16.65 16.65" stroke="#909399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                            </i>
                                        </span>
                                    </div>
                                    
                                    <!-- 月份选择器 -->
                                    <div class="el-date-editor el-input--prefix el-input--suffix el-date-editor--month" style="width: 220px; position: relative;">
                                        <i class="el-input__icon el-icon-date" style="color: #00B45E; position: absolute; left: 8px; top: 50%; transform: translateY(-50%); display: inline-block;">
                                            <svg viewBox="0 0 1024 1024" width="16" height="16">
                                                <path d="M896 352h-768v480h768v-480zM384 192v-64h-64v64h-256v736h896v-736h-256v-64h-64v64h-256z" fill="#00B45E"></path>
                                                <path d="M704 576h64v64h-64zM704 704h64v64h-64zM576 704h64v64h-64zM576 576h64v64h-64zM448 576h64v64h-64zM448 704h64v64h-64zM320 704h64v64h-64zM320 576h64v64h-64z" fill="#00B45E"></path>
                                            </svg>
                                        </i>
                                        <input type="text" autocomplete="off" placeholder="选择月" readonly="readonly" class="el-input__inner" id="monthPicker" style="width: 100%; height: 32px; line-height: 32px; padding: 0 30px 0 30px; background-color: #FFFFFF; background-image: none; border-radius: 4px; border: 1px solid #DCDFE6; box-sizing: border-box; color: #606266; font-size: 14px;" value="2025-05">
                                        <i class="el-input__icon el-icon-circle-close" style="display: none; position: absolute; right: 25px; top: 50%; transform: translateY(-50%); z-index: 10; cursor: pointer;">
                                            <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                <path d="M512 421.490332l-150.665532-150.665532-90.516668 90.516668 150.665532 150.665532-150.665532 150.665532 90.516668 90.516668 150.665532-150.665532 150.665532 150.665532 90.516668-90.516668-150.665532-150.665532 150.665532-150.665532-90.516668-90.516668z" fill="#C0C4CC"></path>
                                            </svg>
                                        </i>
                                        <i class="el-input__icon el-icon-arrow-down" style="color: #C0C4CC; position: absolute; right: 8px; top: 50%; transform: translateY(-50%);">
                                            <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                <path d="M512 714.666667c-8.533333 0-17.066667-2.133333-23.466667-8.533334l-341.333333-341.333333c-12.8-12.8-12.8-32 0-44.8 12.8-12.8 32-12.8 44.8 0l320 317.866667 317.866667-320c12.8-12.8 32-12.8 44.8 0 12.8 12.8 12.8 32 0 44.8L533.333333 704c-4.266667 8.533333-12.8 10.666667-21.333333 10.666667z" fill="#C0C4CC"></path>
                                            </svg>
                                        </i>
                                    </div>
                                    
                                    <!-- 导出按钮 -->
                                    <button class="el-button el-button--primary" style="background-color: #00B45E; border-color: #00B45E; color: white; padding: 8px 16px; border-radius: 4px; font-size: 14px; cursor: pointer; border: none;" id="exportExcelBtn">
                                        <i class="el-icon-download" style="margin-right: 4px;">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M7 10L12 15L17 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M12 15V3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </i>
                                        导出Excel
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 表格内容 -->
                            <div class="el-table" style="width: 100%; flex: 1; overflow: auto; display: flex; flex-direction: column;">
                                <div class="el-table__header-wrapper" style="flex-shrink: 0;">
                                    <table class="el-table__header" style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                        <colgroup>
                                            <col width="60">
                                            <col width="120">
                                            <col width="80">
                                            <col width="120">
                                            <col width="100">
                                            <col width="120">
                                            <col width="120">
                                            <col width="120">
                                            <col width="120">
                                        </colgroup>
                                        <thead>
                                            <tr>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        序号
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        账户名称
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        承包人
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        钱包名称
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        收费项
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        开始时间
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        截止时间
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        起码读数
                                                </th>
                                                <th style="background-color: #FAFCFF; padding: 10px 24px; text-align: left; font-size: 12px; font-weight: 400; color: #424E5F; border-bottom: 1px solid #DCDFE6;">
                                                        止码读数
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                                <div class="el-table__body-wrapper" style="flex: 1; overflow: auto;">
                                    <table class="el-table__body" style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                        <colgroup>
                                            <col width="60">
                                            <col width="120">
                                            <col width="80">
                                            <col width="120">
                                            <col width="100">
                                            <col width="120">
                                            <col width="120">
                                            <col width="120">
                                            <col width="120">
                                        </colgroup>
                                        <tbody>
                                            <!-- 表格数据行 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- 分页器 -->
                            <div class="el-pagination is-background" style="padding: 16px 24px; text-align: right; margin-top: auto; border-top: 1px solid #EBEEF5; flex-shrink: 0; display: flex; justify-content: flex-end; align-items: center;">
                                <span class="el-pagination__total" style="margin-right: 16px; font-size: 13px; color: #606266;">共 20 条</span>
                                <span class="el-pagination__sizes" style="margin-right: 16px;">
                                    <div class="el-select el-select--mini" style="margin-right: 16px;">
                                        <div class="el-input el-input--mini el-input--suffix" style="width: 110px;">
                                            <input type="text" readonly="readonly" autocomplete="off" placeholder="请选择" class="el-input__inner" value="10 条/页" style="height: 28px; line-height: 28px; font-size: 13px; border-radius: 3px; padding: 0 8px 0 10px; border: 1px solid #DCDFE6;">
                                            <span class="el-input__suffix" style="right: 5px;">
                                                <span class="el-input__suffix-inner">
                                                    <i class="el-select__caret el-input__icon el-icon-arrow-up is-reverse" style="color: #C0C4CC; font-size: 13px;">
                                                        <svg viewBox="0 0 1024 1024" width="12" height="12">
                                                            <path d="M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z" fill="#C0C4CC"></path>
                                                        </svg>
                                                    </i>
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </span>
                                <button type="button" disabled="disabled" class="btn-prev" style="margin: 0 5px; background-color: #f4f4f5; min-width: 30px; height: 32px; border: none; border-radius: 2px; padding: 0; cursor: pointer; color: #606266;">
                                    <i class="el-icon el-icon-arrow-left" style="font-size: 13px;">
                                        <svg viewBox="0 0 1024 1024" width="12" height="12">
                                            <path d="M561.873 752c8.19 0 16.379-3.124 22.628-9.372 12.496-12.497 12.496-32.759 0-45.256L432.125 544l152.376-153.373c12.496-12.497 12.496-32.758 0-45.255-12.498-12.497-32.758-12.497-45.256 0l-174.803 175.999c-12.496 12.497-12.496 32.759 0 45.256l174.802 176.0c6.249 6.249 14.439 9.373 22.629 9.373z" fill="#C0C4CC"></path>
                                        </svg>
                                    </i>
                                </button>
                                <ul class="el-pager" style="list-style: none; padding: 0; margin: 0; display: flex; font-size: 13px;">
                                    <li class="number active" style="min-width: 30px; height: 32px; line-height: 32px; text-align: center; margin: 0 5px; cursor: pointer; color: #fff; background-color: #00B45E; border-radius: 2px; font-weight: bold;">1</li>
                                    <li class="number" style="min-width: 30px; height: 32px; line-height: 32px; text-align: center; margin: 0 5px; cursor: pointer; color: #606266; background-color: #f4f4f5; border-radius: 2px;">2</li>
                                </ul>
                                <button type="button" class="btn-next" style="margin: 0 5px; background-color: #f4f4f5; min-width: 30px; height: 32px; border: none; border-radius: 2px; padding: 0; cursor: pointer; color: #606266;">
                                    <i class="el-icon el-icon-arrow-right" style="font-size: 13px;">
                                        <svg viewBox="0 0 1024 1024" width="12" height="12">
                                            <path d="M462.127 752c-8.19 0-16.379-3.124-22.628-9.372-12.496-12.497-12.496-32.759 0-45.256L591.875 544 439.499 390.627c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0l174.803 175.999c12.496 12.497 12.496 32.759 0 45.256L484.756 742.627C478.506 748.876 470.317 752 462.127 752z" fill="#606266"></path>
                                        </svg>
                                    </i>
                                </button>
                                <span class="el-pagination__jump" style="margin-left: 16px; font-size: 13px; color: #606266;">
                                    前往
                                    <div class="el-input el-pagination__editor is-in-pagination" style="width: 50px; margin: 0 5px;">
                                        <input type="number" min="1" max="2" class="el-input__inner" value="1" style="height: 28px; line-height: 28px; text-align: center; font-size: 13px; border-radius: 3px; padding: 0 8px; border: 1px solid #DCDFE6;">
                                    </div>
                                    页
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/ai-assistant.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 定义全局变量存储能耗数据
        let energyDataGlobal = null;
        let currentSelectedTenant = "恒和园"; // 默认选中的租户
        let currentPage = 1; // 当前页码
        let pageSize = 10; // 每页显示条数
        let currentMonth = "2025/05"; // 当前选择的月份
        let currentYear = 2025; // 当前选择的年份
        
        // 初始化所有功能
        initFeatures();
        
        // 初始化AI助手
        window.aiAssistant = new AIAssistant();
        
        // 处理URL参数并执行对应搜索
        processUrlParameters();
        
        // 抽屉式二级菜单交互
        document.getElementById('safetyMenuItem').addEventListener('click', function(e) {
            e.preventDefault();
            const subnavContainer = document.querySelector('.subnav-container');
            subnavContainer.classList.toggle('visible');
            
            // 调整主内容区域宽度
            if (subnavContainer.classList.contains('visible')) {
                document.querySelector('.main-content').classList.add('with-subnav');
            } else {
                document.querySelector('.main-content').classList.remove('with-subnav');
            }
        });
        
        // 导航折叠/展开
        document.getElementById('navToggle').addEventListener('click', function() {
            document.querySelector('.main-content').classList.toggle('expanded');
        });
        
        // 高亮当前页面对应的导航项
        function highlightCurrentNav() {
            // 获取当前页面URL
            const currentUrl = window.location.pathname;
            const pageName = currentUrl.substring(currentUrl.lastIndexOf('/') + 1);
            
            // 高亮主导航项
            document.querySelectorAll('.nav-item').forEach(function(item) {
                const link = item.querySelector('a.nav-link');
                if (link) {
                    const href = link.getAttribute('href');
                    if (href === pageName || (href === 'energy-trend.html' && pageName === 'energy-trend.html')) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                }
            });
            
            // 如果是安全用电子页面，高亮对应的子导航项
            document.querySelectorAll('.subnav-item').forEach(function(item) {
                const link = item.querySelector('a.subnav-link');
                if (link && link.getAttribute('href') === pageName) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // 显示子导航
            document.querySelector('.subnav-container').classList.add('visible');
            document.querySelector('.main-content').classList.add('with-subnav');
        }
        
        // 页面加载时执行高亮
        highlightCurrentNav();
        
        // 绑定租户节点点击事件
        function bindTenantTreeEvents() {
            document.querySelectorAll('.el-tree-node__content').forEach(function(item) {
                item.addEventListener('click', function(e) {
                    // 如果点击的是展开图标
                    if (e.target.closest('.el-tree-node__expand-icon:not(.is-leaf)')) {
                        const treeNode = this.closest('.el-tree-node');
                        const expandIcon = treeNode.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                        const childrenContainer = treeNode.querySelector('.el-tree-node__children');
                        
                        // 切换展开/折叠状态
                        if (treeNode.classList.contains('is-expanded')) {
                            treeNode.classList.remove('is-expanded');
                            expandIcon.style.transform = 'rotate(0deg)';
                            childrenContainer.style.display = 'none';
                        } else {
                            treeNode.classList.add('is-expanded');
                            expandIcon.style.transform = 'rotate(90deg)';
                            childrenContainer.style.display = 'block';
                        }
                        
                        e.stopPropagation();
                        return;
                    }
                    
                    // 处理节点选中状态
                    const treeNode = this.closest('.el-tree-node');
                    const nodeLabel = this.querySelector('.el-tree-node__label');
                    
                    if (nodeLabel) {
                        const tenantName = nodeLabel.textContent.trim();
                        
                        // 存储当前选中的租户
                        currentSelectedTenant = tenantName;
                        
                        // 移除其他节点的选中状态
                        document.querySelectorAll('.el-tree-node.is-current').forEach(function(node) {
                            if (node !== treeNode) {
                                node.classList.remove('is-current');
                                const nodeContent = node.querySelector('.el-tree-node__content');
                                nodeContent.style.backgroundColor = 'white';
                                const label = nodeContent.querySelector('.el-tree-node__label');
                                if (label) {
                                    label.style.color = '#606266';
                                    label.style.fontWeight = 'normal';
                                }
                                
                                // 恢复展开图标颜色
                                const expandIcon = nodeContent.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                                if (expandIcon) {
                                    const svg = expandIcon.querySelector('svg path');
                                    if (svg) svg.setAttribute('fill', '#C0C4CC');
                                }
                            }
                        });
                        
                        // 设置当前节点选中状态
                        treeNode.classList.add('is-current');
                        this.style.backgroundColor = '#F5F7FA';
                        if (nodeLabel) {
                            nodeLabel.style.color = '#409EFF';
                            nodeLabel.style.fontWeight = '500';
                        }
                        
                        // 修改展开图标颜色
                        const expandIcon = this.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                        if (expandIcon) {
                            const svg = expandIcon.querySelector('svg path');
                            if (svg) svg.setAttribute('fill', '#409EFF');
                        }
                        
                        // 重置分页并更新表格数据
                        currentPage = 1;
                        updatePagination();
                        updateTableData(tenantName);
                    }
                });
            });
        }
        
        // 初始化租户搜索功能
        function initTenantSearch() {
            const searchInput = document.querySelector('.el-card__body .el-input__inner[placeholder="请输入关键字"]');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchText = e.target.value.trim().toLowerCase();
                    const allNodes = document.querySelectorAll('.el-tree-node');
                    
                    if (searchText === '') {
                        // 如果搜索框为空，显示所有节点
                        allNodes.forEach(node => {
                            node.style.display = '';
                        });
                        return;
                    }
                    
                    // 隐藏所有节点
                    allNodes.forEach(node => {
                        node.style.display = 'none';
                    });
                    
                    // 查找匹配节点并显示
                    allNodes.forEach(node => {
                        const label = node.querySelector('.el-tree-node__label');
                        if (label && label.textContent.trim().toLowerCase().includes(searchText)) {
                            // 显示当前节点
                            node.style.display = '';
                            
                            // 确保父节点也显示且展开
                            let parent = node.parentElement.closest('.el-tree-node');
                            while (parent) {
                                parent.style.display = '';
                                
                                // 确保父节点展开
                                if (!parent.classList.contains('is-expanded')) {
                                    parent.classList.add('is-expanded');
                                    const expandIcon = parent.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                                    if (expandIcon) {
                                        expandIcon.style.transform = 'rotate(90deg)';
                                    }
                                    const children = parent.querySelector('.el-tree-node__children');
                                    if (children) {
                                        children.style.display = 'block';
                                    }
                                }
                                
                                parent = parent.parentElement.closest('.el-tree-node');
                            }
                        }
                    });
                });
            }
        }
        
        // 更新表格数据函数
        function updateTableData(tenantName) {
            // 这里可以根据租户名称更新表格数据
            // 例如可以使用AJAX请求后端数据，或者从预先加载的数据中筛选
            console.log('更新表格数据，当前选中租户:', tenantName, '当前页码:', currentPage, '每页条数:', pageSize, '当前月份:', currentMonth);
            
            // 更新左上角显示的租户名称
            const selectedTenantNameElement = document.getElementById('selectedTenantName');
            if (selectedTenantNameElement) {
                selectedTenantNameElement.textContent = tenantName;
            }
            
            // 模拟数据 - 实际项目中应该从后端获取
            const mockData = {
                "租户总体": generateMonthlyData("租户总体", [
                    { id: 1, account: "##总账户001", owner: "张总", wallet: "##总钱包001", baseReading: 100000 },
                    { id: 2, account: "##总账户002", owner: "李总", wallet: "##总钱包002", baseReading: 200000 },
                    { id: 3, account: "##总账户003", owner: "王总", wallet: "##总钱包003", baseReading: 300000 },
                    { id: 4, account: "##总账户004", owner: "赵总", wallet: "##总钱包004", baseReading: 400000 },
                    { id: 5, account: "##总账户005", owner: "陈总", wallet: "##总钱包005", baseReading: 500000 }
                ]),
                "恒和园": generateMonthlyData("恒和园", [
                    { id: 1, account: "##账户001", owner: "张婷", wallet: "##钱包001", baseReading: 102202 },
                    { id: 2, account: "##账户002", owner: "张芳", wallet: "##钱包002", baseReading: 102202 },
                    { id: 3, account: "##账户003", owner: "李四", wallet: "##钱包003", baseReading: 102202 },
                    { id: 4, account: "##账户004", owner: "张世武", wallet: "##钱包004", baseReading: 102202 },
                    { id: 5, account: "##账户005", owner: "王明", wallet: "##钱包005", baseReading: 102202 },
                    { id: 6, account: "##账户006", owner: "李华", wallet: "##钱包006", baseReading: 102202 }
                ]),
                "恒和园一层": generateMonthlyData("恒和园一层", [
                    { id: 1, account: "##一层账户001", owner: "陈一", wallet: "##一层钱包001", baseReading: 102500 },
                    { id: 2, account: "##一层账户002", owner: "王二", wallet: "##一层钱包002", baseReading: 103000 }
                ]),
                "恒和园二层": generateMonthlyData("恒和园二层", [
                    { id: 1, account: "##二层账户001", owner: "钱一", wallet: "##二层钱包001", baseReading: 202500 },
                    { id: 2, account: "##二层账户002", owner: "孙二", wallet: "##二层钱包002", baseReading: 203000 }
                ]),
                "知春园南区": generateMonthlyData("知春园南区", [
                    { id: 1, account: "##南区账户001", owner: "王南", wallet: "##南区钱包001", baseReading: 302202 },
                    { id: 2, account: "##南区账户002", owner: "李南", wallet: "##南区钱包002", baseReading: 402202 }
                ]),
                "知春园东区": generateMonthlyData("知春园东区", [
                    { id: 1, account: "##东区账户001", owner: "王东", wallet: "##东区钱包001", baseReading: 502202 },
                    { id: 2, account: "##东区账户002", owner: "李东", wallet: "##东区钱包002", baseReading: 602202 }
                ]),
                "锦秋园": generateMonthlyData("锦秋园", [
                    { id: 1, account: "##锦秋账户001", owner: "王秋", wallet: "##锦秋钱包001", baseReading: 802202 },
                    { id: 2, account: "##锦秋账户002", owner: "李秋", wallet: "##锦秋钱包002", baseReading: 902202 }
                ])
            };
            
            // 生成1月至5月的账单数据
            function generateMonthlyData(tenantType, accounts) {
                return accounts.map(account => {
                    // 针对每个账户，生成1-5月的费用数据
                    const monthlyFees = [];
                    
                    // 费用类型
                    const feeTypes = ["电分摊方案", "物业费", "租金", "其他"];
                    
                    // 随机选择2-4种费用类型
                    const accountFeeTypes = [];
                    const numFeeTypes = Math.floor(Math.random() * 3) + 2; // 2-4种费用
                    
                    // 确保"电分摊方案"总是包含在内
                    accountFeeTypes.push("电分摊方案");
                    
                    // 随机添加其他费用类型
                    const otherTypes = feeTypes.slice(1);
                    for (let i = 0; i < numFeeTypes - 1; i++) {
                        if (i < otherTypes.length) {
                            accountFeeTypes.push(otherTypes[i]);
                        }
                    }
                    
                    // 生成1-5月的数据
                    for (let month = 1; month <= 5; month++) {
                        const monthStr = String(month).padStart(2, '0');
                        const startDate = `2025/${monthStr}/01`;
                        const endDate = `2025/${monthStr}/${month === 2 ? '28' : '30'}`;
                        
                        // 为每个月随机生成读数增量
                        const monthlyIncrements = {};
                        accountFeeTypes.forEach(type => {
                            const baseIncrement = Math.floor(Math.random() * 300) + 100; // 100-399的增量
                            monthlyIncrements[type] = baseIncrement;
                        });
                        
                        // 累计上个月的读数
                        let currentReading = account.baseReading;
                        if (month > 1) {
                            // 每个月增加一个基准值
                            currentReading += (month - 1) * 500;
                        }
                        
                        // 生成每种费用类型的数据
                        const fees = accountFeeTypes.map(type => ({
                            type,
                            startDate,
                            endDate,
                            startReading: String(currentReading),
                            endReading: String(currentReading + monthlyIncrements[type])
                        }));
                        
                        // 将本月的费用数据添加到账户数据中
                        fees.forEach(fee => monthlyFees.push(fee));
                    }
                    
                    return {
                        id: account.id,
                        account: account.account,
                        owner: account.owner,
                        wallet: account.wallet,
                        fees: monthlyFees
                    };
                });
            }
            
            // 获取当前选中租户的数据
            const tenantData = mockData[tenantName] || [];
            
            // 获取表格的tbody元素
            const tbody = document.querySelector('.el-table__body tbody');
            if (!tbody) {
                console.error('未找到表格的tbody元素');
                return;
            }
            
            // 清空现有的表格行
            tbody.innerHTML = '';
            
            // 筛选日期匹配的数据
            const filteredData = tenantData.filter(item => {
                // 检查每个账户的收费项是否有与当前选择月份匹配的
                return item.fees.some(fee => {
                    const feeStartMonth = fee.startDate.substring(0, 7).replace('-', '/');
                    return feeStartMonth === currentMonth;
                });
            });
            
            // 计算分页
            const totalItems = filteredData.length;
            const totalPages = Math.ceil(totalItems / pageSize);
            const start = (currentPage - 1) * pageSize;
            const end = Math.min(start + pageSize, totalItems);
            const paginatedData = filteredData.slice(start, end);
            
            // 更新分页信息
            updatePaginationInfo(totalItems, totalPages);
            
            // 添加新的表格行，每个收费项单独一行
            paginatedData.forEach(item => {
                // 筛选与当前月份匹配的收费项
                const currentMonthFees = item.fees.filter(fee => {
                    const feeStartMonth = fee.startDate.substring(0, 7).replace('-', '/');
                    return feeStartMonth === currentMonth;
                });

                // 如果没有匹配的收费项，不显示此账户
                if (currentMonthFees.length === 0) return;
                
                // 遍历每个账户的所有收费项
                currentMonthFees.forEach((fee, feeIndex) => {
                    const row = document.createElement('tr');
                    
                    // 只在每个账户的第一个收费项行显示账户信息
                    if (feeIndex === 0) {
                        row.innerHTML = `
                            <td style="padding: 10px 24px; text-align: left; font-size: 12px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${currentMonthFees.length}">${String(item.id).padStart(2, '0')}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${currentMonthFees.length}">${item.account}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${currentMonthFees.length}">${item.owner}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${currentMonthFees.length}">${item.wallet}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.type}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startDate}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endDate}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startReading}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endReading}</td>
                        `;
                    } else {
                        row.innerHTML = `
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.type}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startDate}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endDate}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startReading}</td>
                            <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endReading}</td>
                        `;
                    }
                    
                    // 将行添加到表格
                    tbody.appendChild(row);
                });
            });
        }
        
        // 更新分页信息
        function updatePaginationInfo(totalItems, totalPages) {
            // 更新总条数显示
            const totalDisplay = document.querySelector('.el-pagination__total');
            if (totalDisplay) {
                totalDisplay.textContent = `共 ${totalItems} 条`;
            }
            
            // 更新分页器
            updatePagination(totalPages);
        }
        
        // 更新分页器
        function updatePagination(totalPages = 2) {
            // 获取分页器元素
            const pager = document.querySelector('.el-pager');
            if (!pager) return;
            
            // 清空现有页码
            pager.innerHTML = '';
            
            // 如果总页数较少，直接显示所有页码
            if (totalPages <= 5) {
                for (let i = 1; i <= totalPages; i++) {
                    const isActive = i === currentPage;
                    pager.innerHTML += `
                        <li class="number ${isActive ? 'active' : ''}">${i}</li>
                    `;
                }
            } else {
                // 复杂分页逻辑，显示当前页附近的页码
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // 调整开始页，确保总是显示5个页码（如果可能的话）
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                // 添加第一页
                if (startPage > 1) {
                    pager.innerHTML += `<li class="number">1</li>`;
                    
                    // 添加省略号
                    if (startPage > 2) {
                        pager.innerHTML += `<li class="el-icon more btn-quickprev el-icon-more"></li>`;
                    }
                }
                
                // 添加中间的页码
                for (let i = startPage; i <= endPage; i++) {
                    const isActive = i === currentPage;
                    pager.innerHTML += `<li class="number ${isActive ? 'active' : ''}">${i}</li>`;
                }
                
                // 添加最后一页
                if (endPage < totalPages) {
                    // 添加省略号
                    if (endPage < totalPages - 1) {
                        pager.innerHTML += `<li class="el-icon more btn-quicknext el-icon-more"></li>`;
                    }
                    
                    pager.innerHTML += `<li class="number">${totalPages}</li>`;
                }
            }
            
            // 添加页码点击事件
            pager.querySelectorAll('.number').forEach(pageBtn => {
                pageBtn.addEventListener('click', function() {
                    const page = parseInt(this.textContent);
                    if (!isNaN(page)) {
                        changePage(page);
                    }
                });
            });
            
            // 更新前进后退按钮状态
            const prevBtn = document.querySelector('.btn-prev');
            const nextBtn = document.querySelector('.btn-next');
            
            if (prevBtn) {
                if (currentPage === 1) {
                    prevBtn.setAttribute('disabled', 'disabled');
                } else {
                    prevBtn.removeAttribute('disabled');
                }
            }
            
            if (nextBtn) {
                if (currentPage === totalPages) {
                    nextBtn.setAttribute('disabled', 'disabled');
                } else {
                    nextBtn.removeAttribute('disabled');
                }
            }
            
            // 更新前往输入框
            const jumpInput = document.querySelector('.el-pagination__editor .el-input__inner');
            if (jumpInput) {
                jumpInput.setAttribute('max', totalPages);
                jumpInput.value = currentPage;
            }
        }
        
        // 切换页码
        function changePage(page) {
            currentPage = page;
            updateTableData(currentSelectedTenant);
        }
        
        // 初始化分页控件
        function initPagination() {
            // 前一页按钮
            const prevBtn = document.querySelector('.btn-prev');
            if (prevBtn) {
                prevBtn.addEventListener('click', function() {
                    if (this.hasAttribute('disabled')) return;
                    changePage(currentPage - 1);
                });
            }
            
            // 后一页按钮
            const nextBtn = document.querySelector('.btn-next');
            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    if (this.hasAttribute('disabled')) return;
                    changePage(currentPage + 1);
                });
            }
            
            // 页码点击
            document.querySelectorAll('.el-pager .number').forEach(pageBtn => {
                pageBtn.addEventListener('click', function() {
                    const page = parseInt(this.textContent);
                    if (!isNaN(page)) {
                        changePage(page);
                    }
                });
            });
            
            // 跳转输入框
            const jumpInput = document.querySelector('.el-pagination__editor .el-input__inner');
            if (jumpInput) {
                jumpInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const page = parseInt(this.value);
                        const max = parseInt(this.getAttribute('max'));
                        if (page >= 1 && page <= max) {
                            changePage(page);
                        } else {
                            this.value = currentPage;
                        }
                    }
                });
            }
            
            // 每页条数选择
            const pageSizeSelect = document.querySelector('.el-pagination__sizes .el-input__inner');
            if (pageSizeSelect) {
                pageSizeSelect.addEventListener('click', function(e) {
                    // 模拟Element Plus的下拉选择行为
                    // 实际项目中应使用Element Plus的完整组件
                    console.log('点击了每页条数选择器');
                    
                    // 为了演示，我们简单地提供一个选择
                    const options = [10, 20, 30, 50];
                    const selectedOption = prompt('请选择每页条数 (10, 20, 30, 50)', pageSize);
                    const newSize = parseInt(selectedOption);
                    
                    if (options.includes(newSize)) {
                        pageSize = newSize;
                        pageSizeSelect.value = `${newSize} 条/页`;
                        
                        // 重置页码并更新表格
                        currentPage = 1;
                        updateTableData(currentSelectedTenant);
                    }
                    
                    e.stopPropagation();
                });
            }
        }
        
        // 初始化月份选择器
        function initMonthPicker() {
            const monthPicker = document.getElementById('monthPicker');
            const datePickerContainer = document.querySelector('.el-date-editor--month');
            
            if (monthPicker && datePickerContainer) {
                // 确保日期图标始终显示
                const dateIcon = datePickerContainer.querySelector('.el-icon-date');
                if (dateIcon) {
                    dateIcon.style.display = 'inline-block';
                }
                
                // 创建月份选择器弹窗
                function showMonthPicker() {
                    // 创建弹窗元素
                    const pickerPopup = document.createElement('div');
                    pickerPopup.className = 'el-picker-panel el-date-picker el-popper';
                    pickerPopup.style.position = 'absolute';
                    pickerPopup.style.zIndex = '2000';
                    pickerPopup.style.backgroundColor = '#fff';
                    pickerPopup.style.border = '1px solid #e4e7ed';
                    pickerPopup.style.borderRadius = '4px';
                    pickerPopup.style.boxShadow = '0 2px 12px 0 rgba(0,0,0,.1)';
                    pickerPopup.style.padding = '8px';
                    pickerPopup.style.minWidth = '300px';
                    
                    // 获取选择器位置
                    const rect = datePickerContainer.getBoundingClientRect();
                    pickerPopup.style.top = (rect.bottom + window.scrollY + 5) + 'px';
                    pickerPopup.style.left = rect.left + window.scrollX + 'px';
                    
                    // 当前日期
                    const currentDate = new Date();
                    let selectedYear = currentYear || currentDate.getFullYear();
                    let tempMonth = currentMonth ? currentMonth.replace('/', '-') : '';
                    let selectedMonth = tempMonth ? parseInt(tempMonth.split('-')[1]) : (currentDate.getMonth() + 1);
                    
                    // 创建年份选择器
                    const yearSelector = document.createElement('div');
                    yearSelector.className = 'el-date-picker__header';
                    yearSelector.style.marginBottom = '8px';
                    yearSelector.style.textAlign = 'center';
                    yearSelector.style.lineHeight = '22px';
                    yearSelector.innerHTML = `
                        <button type="button" class="el-picker-panel__icon-btn el-date-picker__prev-btn el-icon-d-arrow-left" style="margin: 0 5px; border: none; background: none; cursor: pointer; padding: 0;">
                            <i class="el-icon-d-arrow-left" style="font-size: 12px; color: #606266;">
                                <svg viewBox="0 0 1024 1024" width="12" height="12">
                                    <path d="M603.328 528.128l308.224-308.224c16.896-16.896 16.896-45.056 0-61.952s-45.056-16.896-61.952 0L530.432 477.184l0 0c-4.096 4.096-4.096 10.24 0 14.336l318.976 318.976c16.896 16.896 45.056 16.896 61.952 0s16.896-45.056 0-61.952L603.328 541.696C600.576 538.624 600.576 531.2 603.328 528.128zM185.856 477.184c-4.096-4.096-10.24-4.096-14.336 0L189.952 512l-14.336-34.816c-16.896-16.896-45.056-16.896-61.952 0s-16.896 45.056 0 61.952l318.976 318.976c16.896 16.896 45.056 16.896 61.952 0s16.896-45.056 0-61.952L185.856 477.184z" fill="#606266"></path>
                                </svg>
                            </i>
                        </button>
                        <span class="el-date-picker__header-label" style="font-size: 16px; font-weight: 500; padding: 0 5px; color: #606266;">${selectedYear}年</span>
                        <button type="button" class="el-picker-panel__icon-btn el-date-picker__next-btn el-icon-d-arrow-right" style="margin: 0 5px; border: none; background: none; cursor: pointer; padding: 0;">
                            <i class="el-icon-d-arrow-right" style="font-size: 12px; color: #606266;">
                                <svg viewBox="0 0 1024 1024" width="12" height="12">
                                    <path d="M420.672 528.128l-308.224-308.224c-16.896-16.896-16.896-45.056 0-61.952s45.056-16.896 61.952 0L493.568 477.184l0 0c4.096 4.096 4.096 10.24 0 14.336L174.592 810.496c-16.896 16.896-45.056 16.896-61.952 0s-16.896-45.056 0-61.952l308.032-307.2C423.424 438.272 423.424 430.848 420.672 428.032zM838.144 477.184c4.096-4.096 10.24-4.096 14.336 0L834.048 512l14.336-34.816c16.896-16.896 45.056-16.896 61.952 0s16.896 45.056 0 61.952l-318.976 318.976c-16.896 16.896-45.056 16.896-61.952 0s-16.896-45.056 0-61.952L838.144 477.184z" fill="#606266"></path>
                                </svg>
                            </i>
                        </button>
                    `;
                    
                    // 创建月份选择器
                    const monthSelector = document.createElement('div');
                    monthSelector.className = 'el-picker-panel__content';
                    monthSelector.style.display = 'flex';
                    monthSelector.style.flexWrap = 'wrap';
                    monthSelector.style.padding = '8px 0';
                    
                    // 生成月份按钮
                    const months = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
                    for (let i = 0; i < 12; i++) {
                        const monthBtn = document.createElement('button');
                        monthBtn.className = 'el-picker-panel__month-button';
                        monthBtn.style.width = 'calc(100% / 4)';
                        monthBtn.style.height = '56px';
                        monthBtn.style.textAlign = 'center';
                        monthBtn.style.margin = '0';
                        monthBtn.style.padding = '15px 0';
                        monthBtn.style.border = 'none';
                        monthBtn.style.background = 'none';
                        monthBtn.style.cursor = 'pointer';
                        monthBtn.style.fontSize = '14px';
                        monthBtn.style.color = '#606266';
                        monthBtn.style.borderRadius = '4px';
                        
                        // 高亮当前选中的月份
                        if (i + 1 === selectedMonth) {
                            monthBtn.style.color = '#00B45E';
                            monthBtn.style.fontWeight = 'bold';
                        }
                        
                        monthBtn.textContent = months[i];
                        monthBtn.dataset.month = i + 1;
                        
                        // 月份按钮鼠标效果
                        monthBtn.addEventListener('mouseenter', function() {
                            if (i + 1 !== selectedMonth) {
                                this.style.backgroundColor = '#F5F7FA';
                            }
                        });
                        
                        monthBtn.addEventListener('mouseleave', function() {
                            if (i + 1 !== selectedMonth) {
                                this.style.backgroundColor = '';
                            }
                        });
                        
                        // 月份按钮点击事件
                        monthBtn.addEventListener('click', function() {
                            const month = String(this.dataset.month).padStart(2, '0');
                            const newDate = `${selectedYear}-${month}`;
                            
                            // 更新月份选择器值
                            monthPicker.value = newDate;
                            currentMonth = newDate.replace('-', '/');
                            currentYear = selectedYear;
                            
                            // 关闭弹窗
                            document.body.removeChild(pickerPopup);
                            
                            // 更新表格数据
                            currentPage = 1;
                            updateTableData(currentSelectedTenant);
                        });
                        
                        monthSelector.appendChild(monthBtn);
                    }
                    
                    // 添加底部按钮
                    const footer = document.createElement('div');
                    footer.className = 'el-picker-panel__footer';
                    footer.style.borderTop = '1px solid #e4e7ed';
                    footer.style.padding = '12px 10px';
                    footer.style.textAlign = 'right';
                    
                    const cancelBtn = document.createElement('button');
                    cancelBtn.className = 'el-button el-button--text el-button--mini';
                    cancelBtn.textContent = '取消';
                    cancelBtn.style.border = 'none';
                    cancelBtn.style.background = 'none';
                    cancelBtn.style.color = '#606266';
                    cancelBtn.style.cursor = 'pointer';
                    cancelBtn.style.marginRight = '8px';
                    cancelBtn.addEventListener('click', function() {
                        document.body.removeChild(pickerPopup);
                    });
                    
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'el-button el-button--default el-button--mini';
                    confirmBtn.textContent = '确定';
                    confirmBtn.style.padding = '7px 15px';
                    confirmBtn.style.border = '1px solid #dcdfe6';
                    confirmBtn.style.borderRadius = '3px';
                    confirmBtn.style.background = '#fff';
                    confirmBtn.style.color = '#606266';
                    confirmBtn.style.cursor = 'pointer';
                    confirmBtn.addEventListener('click', function() {
                        const month = String(selectedMonth).padStart(2, '0');
                        const newDate = `${selectedYear}-${month}`;
                        
                        // 更新月份选择器值
                        monthPicker.value = newDate;
                        currentMonth = newDate.replace('-', '/');
                        currentYear = selectedYear;
                        
                        // 关闭弹窗
                        document.body.removeChild(pickerPopup);
                        
                        // 更新表格数据
                        currentPage = 1;
                        updateTableData(currentSelectedTenant);
                    });
                    
                    footer.appendChild(cancelBtn);
                    footer.appendChild(confirmBtn);
                    
                    // 添加年份选择事件
                    const prevYearBtn = yearSelector.querySelector('.el-icon-d-arrow-left').parentNode;
                    const nextYearBtn = yearSelector.querySelector('.el-icon-d-arrow-right').parentNode;
                    const yearLabel = yearSelector.querySelector('.el-date-picker__header-label');
                    
                    prevYearBtn.addEventListener('click', function() {
                        selectedYear--;
                        yearLabel.textContent = `${selectedYear}年`;
                    });
                    
                    nextYearBtn.addEventListener('click', function() {
                        selectedYear++;
                        yearLabel.textContent = `${selectedYear}年`;
                    });
                    
                    // 组装弹窗
                    pickerPopup.appendChild(yearSelector);
                    pickerPopup.appendChild(monthSelector);
                    pickerPopup.appendChild(footer);
                    
                    // 添加到body
                    document.body.appendChild(pickerPopup);
                    
                    // 点击外部关闭弹窗
                    document.addEventListener('click', function closePopup(e) {
                        if (!pickerPopup.contains(e.target) && e.target !== monthPicker && !datePickerContainer.contains(e.target)) {
                            document.body.removeChild(pickerPopup);
                            document.removeEventListener('click', closePopup);
                        }
                    });
                }
                
                // 点击事件处理
                datePickerContainer.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showMonthPicker();
                });
                
                // 显示清除图标但不影响布局
                datePickerContainer.addEventListener('mouseenter', function() {
                    const clearIcon = datePickerContainer.querySelector('.el-icon-circle-close');
                    if (clearIcon) {
                        clearIcon.style.display = 'inline-block';
                    }
                });
                
                // 隐藏清除图标
                datePickerContainer.addEventListener('mouseleave', function() {
                    const clearIcon = datePickerContainer.querySelector('.el-icon-circle-close');
                    if (clearIcon) {
                        clearIcon.style.display = 'none';
                    }
                });
                
                // 清除按钮点击事件
                const clearIcon = datePickerContainer.querySelector('.el-icon-circle-close');
                if (clearIcon) {
                    clearIcon.addEventListener('click', function(e) {
                        e.stopPropagation();
                        // 重置为当前月份
                        const now = new Date();
                        const year = now.getFullYear();
                        const month = String(now.getMonth() + 1).padStart(2, '0');
                        const formattedMonth = `${year}-${month}`;
                        
                        currentMonth = formattedMonth.replace('-', '/');
                        monthPicker.value = formattedMonth;
                        
                        // 更新年份
                        currentYear = year;
                        
                        // 重置页码并更新表格
                        currentPage = 1;
                        updateTableData(currentSelectedTenant);
                    });
                }
            }
        }
        
        // 在页面加载完成后绑定事件
        bindTenantTreeEvents();
        initPagination();
        initMonthPicker();
        
        // 初始化表格数据
        updateTableData(currentSelectedTenant);
        
        // 搜索框功能 - 右侧列表搜索
        const searchInput = document.querySelector('.el-input__inner[placeholder="请输入钱包名 账户名"]');
        const searchIcon = document.querySelector('.el-input__inner[placeholder="请输入钱包名 账户名"]').nextElementSibling.querySelector('.el-icon-search');

        if (searchInput) {
            // 移除原先的input事件监听
            searchInput.removeEventListener('input', function() {});
            
            // 添加keydown事件监听，当按下Enter键时执行搜索
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // 防止表单提交
                    const searchText = e.target.value.trim().toLowerCase();
                    executeSearch(searchText);
                }
            });
            
            // 添加搜索图标点击事件
            if (searchIcon) {
                searchIcon.addEventListener('click', function() {
                    const searchText = searchInput.value.trim().toLowerCase();
                    executeSearch(searchText);
                });
                
                // 将搜索图标设为可点击样式
                searchIcon.style.cursor = 'pointer';
            }
        }
        
        // 执行搜索的函数
        function executeSearch(searchText) {
            if (searchText === '') {
                // 如果搜索框为空，显示当前选中租户的所有数据
                updateTableData(currentSelectedTenant);
            } else {
                // 否则进行搜索过滤
                filterTableData(currentSelectedTenant, searchText);
            }
            
            // 添加搜索反馈效果
            const feedbackMessage = document.createElement('div');
            feedbackMessage.className = 'search-feedback';
            feedbackMessage.style.position = 'fixed';
            feedbackMessage.style.top = '80px';
            feedbackMessage.style.left = '50%';
            feedbackMessage.style.transform = 'translateX(-50%)';
            feedbackMessage.style.backgroundColor = '#409EFF';
            feedbackMessage.style.color = 'white';
            feedbackMessage.style.padding = '10px 20px';
            feedbackMessage.style.borderRadius = '4px';
            feedbackMessage.style.zIndex = '9999';
            feedbackMessage.style.boxShadow = '0 2px 12px 0 rgba(0,0,0,0.1)';
            
            if (searchText === '') {
                feedbackMessage.textContent = '已显示全部数据';
            } else {
                // 获取筛选后的数据数量
                const filteredDataCount = document.querySelectorAll('.el-table__body tbody tr').length;
                feedbackMessage.textContent = `搜索关键词: "${searchText}" (找到${filteredDataCount}条记录)`;
            }
            
            document.body.appendChild(feedbackMessage);
            
            // 1.5秒后自动消失
            setTimeout(() => {
                feedbackMessage.style.opacity = '0';
                feedbackMessage.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    if (feedbackMessage.parentNode) {
                        document.body.removeChild(feedbackMessage);
                    }
                }, 500);
            }, 1500);
        }
        
        // 初始化各功能
        function initFeatures() {
            // 初始化租户搜索功能
            initTenantSearch();
            
            // 初始化分页控件
            initPagination();
            
            // 初始化月份选择器
            initMonthPicker();
            
            // 绑定租户节点点击事件
            bindTenantTreeEvents();
        }
        
        // 过滤表格数据函数
        function filterTableData(tenantName, searchText) {
            // 这里可以根据租户名称更新表格数据
            // 例如可以使用AJAX请求后端数据，或者从预先加载的数据中筛选
            console.log('搜索过滤，当前选中租户:', tenantName, '搜索文本:', searchText, '当前月份:', currentMonth);
            
            // 模拟数据 - 实际项目中应该从后端获取
            const mockData = {
                "租户总体": [
                    { id: 1, account: "##总账户001", owner: "张总", wallet: "##总钱包001", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "100000", endReading: "100500" },
                        { type: "物业费", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "100000", endReading: "100300" },
                        { type: "租金", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "100000", endReading: "100400" }
                      ]
                    },
                    { id: 2, account: "##总账户002", owner: "李总", wallet: "##总钱包002", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "200000", endReading: "200450" },
                        { type: "物业费", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "200000", endReading: "200300" },
                        { type: "其他", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "200000", endReading: "200250" }
                      ]
                    }
                ],
                "恒和园": [
                    { id: 1, account: "##账户001", owner: "张婷", wallet: "##钱包001", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102500" },
                        { type: "物业费", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102400" }
                      ]
                    },
                    { id: 2, account: "##账户002", owner: "张芳", wallet: "##钱包002", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102450" },
                        { type: "租金", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102350" }
                      ]
                    },
                    { id: 3, account: "##账户003", owner: "李四", wallet: "##钱包003", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102400" }
                      ]
                    },
                    { id: 4, account: "##账户004", owner: "张世武", wallet: "##钱包004", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102600" },
                        { type: "其他", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102202", endReading: "102300" }
                      ]
                    }
                ],
                "恒和园一层": [
                    { id: 1, account: "##一层账户001", owner: "陈一", wallet: "##一层钱包001", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "102500", endReading: "103000" }
                      ]
                    }
                ],
                "恒和园二层": [
                    { id: 1, account: "##二层账户001", owner: "钱一", wallet: "##二层钱包001", 
                      fees: [
                        { type: "电分摊方案", startDate: "2025/05/01", endDate: "2025/05/31", startReading: "202500", endReading: "203000" }
                      ]
                    }
                ]
            };
            
            // 获取当前选中租户的数据
            const tenantData = mockData[tenantName] || [];
            
            // 获取表格的tbody元素
            const tbody = document.querySelector('.el-table__body tbody');
            if (!tbody) {
                console.error('未找到表格的tbody元素');
                return;
            }
            
            // 清空现有的表格行
            tbody.innerHTML = '';
            
            // 如果搜索文本为空，显示所有数据
            if (!searchText || searchText.trim() === '') {
                // 更新表格数据，显示所有数据
                updateTableData(tenantName);
                return;
            }
            
            const lowerSearchText = searchText.toLowerCase();
            console.log('搜索文本:', lowerSearchText);
            
            // 调试输出原始数据
            console.log('原始租户数据:', tenantData);
            
            // 过滤数据 - 先过滤账户
            const filteredAccounts = tenantData.filter(item => {
                // 调试输出匹配检查
                const accountMatch = item.account.toLowerCase().includes(lowerSearchText);
                const walletMatch = item.wallet.toLowerCase().includes(lowerSearchText);
                const ownerMatch = item.owner.toLowerCase().includes(lowerSearchText);
                const feesMatch = item.fees.some(fee => fee.type.toLowerCase().includes(lowerSearchText));
                
                console.log(`检查账户 ${item.account}:`, {
                    账户匹配: accountMatch,
                    钱包匹配: walletMatch,
                    承包人匹配: ownerMatch,
                    费用类型匹配: feesMatch,
                    承包人: item.owner
                });
                
                return accountMatch || walletMatch || ownerMatch || feesMatch;
            });
            
            console.log('过滤后的账户数据:', filteredAccounts);
            
            // 过滤收费项 - 只保留与当前月份匹配的
            const filteredData = filteredAccounts.map(account => {
                // 筛选与当前月份匹配的收费项
                const currentMonthFees = account.fees.filter(fee => {
                    const feeStartMonth = fee.startDate.substring(0, 7).replace('-', '/');
                    return feeStartMonth === currentMonth;
                });
                
                // 根据搜索条件再次过滤收费项
                let filteredFees = currentMonthFees;
                
                // 如果搜索条件与账户信息匹配，则保留该账户下所有收费项
                // 否则只保留收费项类型匹配的项
                if (!(account.account.toLowerCase().includes(lowerSearchText) || 
                      account.wallet.toLowerCase().includes(lowerSearchText) ||
                      account.owner.toLowerCase().includes(lowerSearchText))) {
                    filteredFees = currentMonthFees.filter(fee => 
                        fee.type.toLowerCase().includes(lowerSearchText)
                    );
                }
                
                return {
                    ...account,
                    fees: filteredFees
                };
            }).filter(account => account.fees.length > 0);
            
            console.log('最终过滤后的数据:', filteredData);
            
            // 计算分页
            const totalItems = filteredData.length;
            const totalPages = Math.ceil(totalItems / pageSize);
            currentPage = Math.min(currentPage, totalPages || 1); // 确保当前页不超过总页数
            const start = (currentPage - 1) * pageSize;
            const end = Math.min(start + pageSize, totalItems);
            const paginatedData = filteredData.slice(start, end);
            
            // 更新分页信息
            updatePaginationInfo(totalItems, totalPages);
            
            // 函数：高亮文本（如果包含搜索关键字）
            function highlightText(text, searchText) {
                if (!searchText || searchText === '') return text;
                
                // 如果不是字符串，直接返回
                if (typeof text !== 'string') return text;
                
                const lowerText = text.toLowerCase();
                const lowerSearchText = searchText.toLowerCase();
                
                // 如果文本中不包含搜索词，直接返回原文本
                if (!lowerText.includes(lowerSearchText)) return text;
                
                // 找到搜索词在原文本中的位置
                const index = lowerText.indexOf(lowerSearchText);
                const beforeMatch = text.substring(0, index);
                const match = text.substring(index, index + searchText.length);
                const afterMatch = text.substring(index + searchText.length);
                
                // 返回带有高亮的HTML
                return `${beforeMatch}<span class="highlight">${match}</span>${afterMatch}`;
            }
            
            // 添加新的表格行，每个收费项单独一行
            if (paginatedData.length === 0) {
                // 如果没有匹配的数据，显示无数据提示
                const noDataRow = document.createElement('tr');
                noDataRow.innerHTML = `
                    <td colspan="9" style="padding: 20px; text-align: center; color: #909399;">
                        没有找到与 "${searchText}" 匹配的数据
                    </td>
                `;
                tbody.appendChild(noDataRow);
            } else {
                paginatedData.forEach(item => {
                    // 遍历每个账户的所有收费项
                    item.fees.forEach((fee, feeIndex) => {
                        const row = document.createElement('tr');
                        
                        // 高亮显示匹配的文本
                        const highlightedAccount = highlightText(item.account, searchText);
                        const highlightedOwner = highlightText(item.owner, searchText);
                        const highlightedWallet = highlightText(item.wallet, searchText);
                        const highlightedType = highlightText(fee.type, searchText);
                        
                        // 只在每个账户的第一个收费项行显示账户信息
                        if (feeIndex === 0) {
                            row.innerHTML = `
                                <td style="padding: 10px 24px; text-align: left; font-size: 12px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${item.fees.length}">${String(item.id).padStart(2, '0')}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${item.fees.length}">${highlightedAccount}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${item.fees.length}">${highlightedOwner}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;" rowspan="${item.fees.length}">${highlightedWallet}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${highlightedType}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startDate}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endDate}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startReading}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endReading}</td>
                            `;
                        } else {
                            row.innerHTML = `
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${highlightedType}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startDate}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endDate}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.startReading}</td>
                                <td style="padding: 10px 24px; text-align: left; font-size: 14px; color: #424E5F; border-bottom: 1px solid #DCDFE6;">${fee.endReading}</td>
                            `;
                        }
                        
                        // 将行添加到表格
                        tbody.appendChild(row);
                    });
                });
            }
        }
        
        // 导出按钮功能
        const exportButton = document.querySelector('#exportExcelBtn');
        if (exportButton) {
            exportButton.addEventListener('click', function() {
                exportToExcel(currentSelectedTenant);
            });
        }
        
        // 初始化所有功能
        initFeatures();
        
        // 导出Excel功能
        function exportToExcel(tenantName) {
            console.log('导出Excel，当前选中租户:', tenantName, '当前月份:', currentMonth);
            
            // 导入SheetJS库（如果尚未导入）
            const loadExcelLibrary = () => {
                return new Promise((resolve, reject) => {
                    if (window.XLSX) {
                        resolve();
                        return;
                    }
                    
                    // 加载xlsx库
                    const script = document.createElement('script');
                    script.src = 'https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js';
                    script.async = true;
                    script.onload = resolve;
                    script.onerror = () => reject(new Error('无法加载Excel导出库'));
                    document.head.appendChild(script);
                });
            };
            
            // 获取当前表格数据
            const getTableData = () => {
                // 获取表头
                const headers = [];
                document.querySelectorAll('.el-table__header th').forEach(th => {
                    headers.push(th.textContent.trim());
                });
                
                // 获取表格数据
                const tableData = [];
                const rows = document.querySelectorAll('.el-table__body tbody tr');
                
                // 处理合并单元格的情况
                let currentRowData = {};
                let rowspanData = {}; // 存储带有rowspan的单元格数据
                
                rows.forEach((row, rowIndex) => {
                    const cells = row.querySelectorAll('td');
                    const rowData = {};
                    
                    cells.forEach((cell, cellIndex) => {
                        const text = cell.textContent.trim();
                        const columnName = headers[cellIndex];
                        
                        // 如果单元格有rowspan属性，存储该值供后续行使用
                        if (cell.hasAttribute('rowspan')) {
                            const rowspan = parseInt(cell.getAttribute('rowspan'));
                            if (rowspan > 1) {
                                rowspanData[columnName] = {
                                    value: text,
                                    remainingRows: rowspan - 1
                                };
                            }
                        }
                        
                        rowData[columnName] = text;
                    });
                    
                    // 添加之前行中带有rowspan的单元格数据
                    Object.entries(rowspanData).forEach(([column, data]) => {
                        if (!rowData[column]) {
                            rowData[column] = data.value;
                        }
                        
                        // 减少剩余行数
                        data.remainingRows--;
                        if (data.remainingRows <= 0) {
                            delete rowspanData[column];
                        }
                    });
                    
                    tableData.push(rowData);
                });
                
                return { headers, tableData };
            };
            
            // 执行导出
            loadExcelLibrary()
                .then(() => {
                    // 显示加载提示
                    const loadingMsg = document.createElement('div');
                    loadingMsg.style.position = 'fixed';
                    loadingMsg.style.top = '50%';
                    loadingMsg.style.left = '50%';
                    loadingMsg.style.transform = 'translate(-50%, -50%)';
                    loadingMsg.style.padding = '20px 40px';
                    loadingMsg.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                    loadingMsg.style.color = 'white';
                    loadingMsg.style.borderRadius = '8px';
                    loadingMsg.style.zIndex = '10000';
                    loadingMsg.textContent = '正在生成Excel文件...';
                    document.body.appendChild(loadingMsg);
                    
                    try {
                        // 获取表格数据
                        const { headers, tableData } = getTableData();
                        
                        if (tableData.length === 0) {
                            alert('没有可导出的数据');
                            document.body.removeChild(loadingMsg);
                            return;
                        }
                        
                        // 创建一个新工作簿
                        const wb = XLSX.utils.book_new();
                        
                        // 转换数据到工作表
                        const ws = XLSX.utils.json_to_sheet(tableData, { header: headers });
                        
                        // 设置列宽
                        const columnWidths = headers.map(() => ({ wch: 15 })); // 默认列宽
                        ws['!cols'] = columnWidths;
                        
                        // 添加工作表到工作簿
                        XLSX.utils.book_append_sheet(wb, ws, `${tenantName}月度账单`);
                        
                        // 生成Excel文件并下载
                        const fileName = `${tenantName}_月度账单_${currentMonth.replace('/', '-')}.xlsx`;
                        XLSX.writeFile(wb, fileName);
                        
                        console.log(`已导出${tenantName}的账单数据到Excel`);
                        
                        // 显示成功提示
                        loadingMsg.textContent = 'Excel文件已生成，请检查下载文件夹';
                        loadingMsg.style.backgroundColor = 'rgba(0, 180, 94, 0.8)';
                        
                        // 2秒后关闭提示
                        setTimeout(() => {
                            if (loadingMsg.parentNode) {
                                document.body.removeChild(loadingMsg);
                            }
                        }, 2000);
                    } catch (error) {
                        console.error('导出Excel失败:', error);
                        loadingMsg.textContent = '导出失败，请稍后再试';
                        loadingMsg.style.backgroundColor = 'rgba(255, 0, 0, 0.8)';
                        
                        // 2秒后关闭提示
                        setTimeout(() => {
                            if (loadingMsg.parentNode) {
                                document.body.removeChild(loadingMsg);
                            }
                        }, 2000);
                    }
                })
                .catch(error => {
                    console.error('加载Excel库失败:', error);
                    alert('导出Excel功能初始化失败，请检查网络连接后重试');
                });
        }
        
        // 处理URL参数的函数
        function processUrlParameters() {
            // 解析URL参数
            const urlParams = new URLSearchParams(window.location.search);
            
            // 增加详细日志，记录所有的查询参数
            console.log('URL参数处理开始, 所有参数:', Object.fromEntries(urlParams.entries()));
            
            // 检查是否有查询参数
            const hasUrlQueryParams = urlParams.has('tenant') || urlParams.has('month') || 
                                 urlParams.has('account') || urlParams.has('wallet') || 
                                 urlParams.has('owner');

            // 从localStorage中检查是否有AI助手保存的查询参数
            let aiAssistantParams = null;
            const lastQueryJson = localStorage.getItem('aiAssistantLastQuery');
            const lastQueryTarget = localStorage.getItem('aiAssistantLastQueryTarget');
            const lastQueryTime = localStorage.getItem('aiAssistantLastQueryTime');
            
            // 只考虑最近30秒内保存的，并且目标是月度账单页面的查询参数
            if (lastQueryJson && lastQueryTarget === 'monthly-bill.html' && lastQueryTime) {
                const timeDiff = Date.now() - parseInt(lastQueryTime);
                if (timeDiff < 30000) { // 30秒内
                    try {
                        aiAssistantParams = JSON.parse(lastQueryJson);
                        console.log('从localStorage读取AI助手查询参数:', aiAssistantParams);
                    } catch (e) {
                        console.error('解析localStorage中的查询参数失败:', e);
                    }
                } else {
                    console.log('localStorage中的查询参数已过期，不使用');
                    // 清除过期的查询参数
                    localStorage.removeItem('aiAssistantLastQuery');
                    localStorage.removeItem('aiAssistantLastQueryTarget');
                    localStorage.removeItem('aiAssistantLastQueryTime');
                }
            }
            
            // 合并URL参数和AI助手参数，URL参数优先级更高
            const combinedParams = {};
            
            // 如果有AI助手参数，先添加它们
            if (aiAssistantParams) {
                Object.entries(aiAssistantParams).forEach(([key, value]) => {
                    if (value !== undefined && value !== null && value !== '') {
                        combinedParams[key] = value;
                    }
                });
            }
            
            // 添加URL参数，覆盖AI助手参数
            if (hasUrlQueryParams) {
                Array.from(urlParams.entries()).forEach(([key, value]) => {
                    if (value !== undefined && value !== null && value !== '') {
                        combinedParams[key] = value;
                    }
                });
            }
            
            const hasQueryParams = Object.keys(combinedParams).length > 0;
            
            if (!hasQueryParams) {
                console.log('没有查询参数，显示默认视图');
                return;
            }
            
            console.log('检测到查询参数，准备执行查询', combinedParams);
            
            // 租户参数
            const tenantParam = combinedParams.tenant;
            if (tenantParam) {
                console.log('租户参数:', tenantParam);
                // 在树形控件中查找并选中对应的租户
                selectTenantInTree(tenantParam);
            }
            
            // 月份参数 (处理不同格式的月份)
            let monthParam = combinedParams.month;
            if (monthParam) {
                console.log('原始月份参数:', monthParam);
                
                // 标准化月份格式
                if (monthParam.includes('-')) {
                    // 如果是YYYY-MM格式，转换为YYYY/MM
                    monthParam = monthParam.replace('-', '/');
                } else if (!monthParam.includes('/')) {
                    // 如果既不包含'-'也不包含'/'，尝试解析并格式化
                    if (monthParam.length === 6) {
                        // 假设是YYYYMM格式
                        const year = monthParam.substring(0, 4);
                        const month = monthParam.substring(4, 6);
                        monthParam = `${year}/${month}`;
                    }
                }
                
                console.log('处理后的月份参数:', monthParam);
                
                // 设置月份选择器并更新当前月份变量
                currentMonth = monthParam;
                
                // 更新月份选择器显示
                const monthPicker = document.getElementById('monthPicker');
                if (monthPicker) {
                    // 月份选择器期望的格式是 yyyy-mm
                    const displayMonth = monthParam.replace('/', '-');
                    monthPicker.value = displayMonth;
                    console.log('设置月份选择器:', displayMonth);
                    
                    // 提取年份
                    const year = monthParam.split('/')[0];
                    if (year) {
                        currentYear = parseInt(year);
                        console.log('设置当前年份:', currentYear);
                    }
                }
            }
            
            // 账户/钱包/承包人参数用于过滤表格数据
            const accountParam = combinedParams.account;
            const walletParam = combinedParams.wallet;
            const ownerParam = combinedParams.owner;
            
            // 记录其他筛选参数
            if (accountParam) console.log('账户参数:', accountParam);
            if (walletParam) console.log('钱包参数:', walletParam);
            if (ownerParam) console.log('承包人参数:', ownerParam);
            
            // 如果有账户/钱包/承包人参数，在搜索框中填入值并触发搜索
            if (accountParam || walletParam || ownerParam) {
                // 构建搜索字符串 - 优先使用最特定的信息
                let searchText = '';
                if (accountParam) {
                    searchText = accountParam;
                } else if (walletParam) {
                    searchText = walletParam;
                } else if (ownerParam) {
                    searchText = ownerParam;
                }
                
                console.log('最终搜索参数:', searchText);
                
                // 在搜索框中填入值
                const searchInput = document.querySelector('.el-input__inner[placeholder="请输入钱包名 账户名"]');
                if (searchInput) {
                    searchInput.value = searchText;
                    console.log('设置搜索框内容:', searchText);
                    
                    // 手动触发搜索逻辑
                    filterTableData(currentSelectedTenant, searchText);
                }
            } else {
                // 如果只有租户或月份参数，更新表格数据
                console.log('没有搜索参数，更新表格数据，当前租户:', currentSelectedTenant);
                updateTableData(currentSelectedTenant);
            }
            
            // 处理完成后简单提示用户
            if (tenantParam || monthParam || accountParam || walletParam || ownerParam) {
                const message = document.createElement('div');
                message.className = 'query-result-message';
                message.style.position = 'fixed';
                message.style.top = '80px';
                message.style.left = '50%';
                message.style.transform = 'translateX(-50%)';
                message.style.backgroundColor = '#409EFF';
                message.style.color = 'white';
                message.style.padding = '10px 20px';
                message.style.borderRadius = '4px';
                message.style.zIndex = '9999';
                message.style.boxShadow = '0 2px 12px 0 rgba(0,0,0,0.1)';
                
                let messageText = '已为您查询';
                if (tenantParam) messageText += `${tenantParam}的`;
                if (monthParam) {
                    const parts = monthParam.split('/');
                    if (parts.length === 2) {
                        messageText += `${parts[0]}年${parseInt(parts[1])}月的`;
                    }
                }
                if (accountParam) messageText += `账户"${accountParam}"的`;
                if (walletParam) messageText += `钱包"${walletParam}"的`;
                if (ownerParam) messageText += `${ownerParam}名下的`;
                messageText += '月度账单';
                
                message.textContent = messageText;
                document.body.appendChild(message);
                
                // 3秒后自动消失
                setTimeout(() => {
                    message.style.opacity = '0';
                    message.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        if (message.parentNode) {
                            document.body.removeChild(message);
                        }
                    }, 500);
                }, 3000);
                
                // 清除localStorage中保存的查询参数，避免下次重复使用
                localStorage.removeItem('aiAssistantLastQuery');
                localStorage.removeItem('aiAssistantLastQueryTarget');
                localStorage.removeItem('aiAssistantLastQueryTime');
            }
        }
        
        // 在树形控件中选中指定租户
        function selectTenantInTree(tenantName) {
            if (!tenantName) return;
            
            console.log('尝试在树形控件中查找租户:', tenantName);
            
            // 在树节点中查找匹配的租户
            const treeNodes = document.querySelectorAll('.el-tree-node__content');
            let found = false;
            let exactMatchNode = null;
            let partialMatchNode = null;
            
            // 第一步：查找完全匹配的节点
            treeNodes.forEach(node => {
                const label = node.querySelector('.el-tree-node__label');
                if (label) {
                    const nodeName = label.textContent.trim();
                    
                    // 检查完全匹配
                    if (nodeName === tenantName) {
                        exactMatchNode = node;
                        console.log('找到完全匹配的租户节点:', nodeName);
                        return;
                    }
                    
                    // 检查部分匹配
                    if (nodeName.includes(tenantName) || tenantName.includes(nodeName)) {
                        partialMatchNode = node;
                        console.log('找到部分匹配的租户节点:', nodeName);
                    }
                    
                    // 处理"知春园"简写情况
                    if (tenantName === '知春园' && 
                        (nodeName === '知春园南区' || nodeName === '知春园东区')) {
                        if (!partialMatchNode) {
                            // 默认选择南区
                            if (nodeName === '知春园南区') {
                                partialMatchNode = node;
                                console.log('知春园简写，默认选择知春园南区');
                            }
                        }
                    }
                }
            });
            
            // 确定要使用的节点，优先使用完全匹配
            const nodeToSelect = exactMatchNode || partialMatchNode;
            
            if (nodeToSelect) {
                found = true;
                const label = nodeToSelect.querySelector('.el-tree-node__label');
                const selectedTenantText = label ? label.textContent.trim() : tenantName;
                console.log('选中租户节点:', selectedTenantText);
                
                // 确保其父节点是展开的
                let parentNode = nodeToSelect.closest('.el-tree-node').parentElement.closest('.el-tree-node');
                while (parentNode) {
                    if (!parentNode.classList.contains('is-expanded')) {
                        // 展开父节点
                        const expandIcon = parentNode.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                        if (expandIcon) {
                            expandIcon.style.transform = 'rotate(90deg)';
                        }
                        parentNode.classList.add('is-expanded');
                        const children = parentNode.querySelector('.el-tree-node__children');
                        if (children) {
                            children.style.display = 'block';
                        }
                    }
                    parentNode = parentNode.parentElement.closest('.el-tree-node');
                }
                
                // 更新当前选中的租户
                currentSelectedTenant = selectedTenantText;
                
                // 模拟点击该节点，设置选中状态
                const treeNode = nodeToSelect.closest('.el-tree-node');
                
                // 移除其他节点的选中状态
                document.querySelectorAll('.el-tree-node.is-current').forEach(function(n) {
                    if (n !== treeNode) {
                        n.classList.remove('is-current');
                        const nodeContent = n.querySelector('.el-tree-node__content');
                        nodeContent.style.backgroundColor = 'white';
                        const nodeLabel = nodeContent.querySelector('.el-tree-node__label');
                        if (nodeLabel) {
                            nodeLabel.style.color = '#606266';
                            nodeLabel.style.fontWeight = 'normal';
                        }
                        
                        // 恢复展开图标颜色
                        const expandIcon = nodeContent.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                        if (expandIcon) {
                            const svg = expandIcon.querySelector('svg path');
                            if (svg) svg.setAttribute('fill', '#C0C4CC');
                        }
                    }
                });
                
                // 设置当前节点选中状态
                treeNode.classList.add('is-current');
                nodeToSelect.style.backgroundColor = '#F5F7FA';
                if (label) {
                    label.style.color = '#409EFF';
                    label.style.fontWeight = '500';
                }
                
                // 修改展开图标颜色
                const expandIcon = nodeToSelect.querySelector('.el-tree-node__expand-icon:not(.is-leaf)');
                if (expandIcon) {
                    const svg = expandIcon.querySelector('svg path');
                    if (svg) svg.setAttribute('fill', '#409EFF');
                }
                
                // 更新左上角显示的租户名称
                const selectedTenantNameElement = document.getElementById('selectedTenantName');
                if (selectedTenantNameElement) {
                    selectedTenantNameElement.textContent = selectedTenantText;
                }
            }
            
            if (!found) {
                console.log('未在树形控件中找到对应租户:', tenantName, '使用默认租户');
                // 如果没有找到任何匹配，使用默认租户
                updateTableData(currentSelectedTenant);
            }
        }
    });
</script>
</body>
</html> 